const body = document.body; body.innerHTML = ""
$.store = idb(assign(scope($), { name: "envjs" }))
css("body", { margin: 0 })
style(body, { paddingBottom: "50%" })

const preload = '{"global-state-location":[{"v":"const mktag = t => $[t] = (...a) => dom({tag:t, child:a})\\n\\"h1 p br pre b\\".split(\\" \\").forEach(mktag)\\nstyle(document.documentElement, {width:\\"50%\\"})\\nstyle(document.body, {margin:\\"1em\\"})\\ncss(\\".right\\",{ textAlign:\\"right\\", marginRight:10 })\\ncss(\\"button\\", {verticalAlign:\\"bottom\\"})\\n\\nconst toggle = () => style(exd0, {height:(e0open=!e0open)?0:10000})\\n$.exb0 = dom({tag:\\"button\\", child:\\"ç‚¹æˆ‘å±•å¼€/æ”¶èµ·éšè—å†…å®¹\\", onclick: toggle})\\n$.exd0 = dom({innerHTML:\\"å‡è®¾æˆ‘è¦æŠŠè¿™æ®µæ–‡æœ¬å†™ä¸Šä¸€åƒé\\".repeat(1000)+\\"<br>ä½ çœ‹ç”¨jså†™å°±å¾ˆå®¹æ˜“å§\\"})\\n$.e0open = false, toggle(), style(exd0, {overflow:\\"hidden\\", transition:\\"all 1s ease-in-out\\"})\\n\\nelm(document.body, {child:[ h1(\\"æ–‡å­¦ç¼–ç¨‹å®è·µ2\\"),\\ndom({tag:\\"h3\\", child:\\"â€”â€”å…³äºå¦‚ä½•åˆ†è§£è½¯ä»¶ï¼Œå•ç‹¬å¼€å‘ï¼Œåˆ†åˆ«æµ‹è¯•ï¼Œå¹¶å°†ç»„ä»¶åˆæˆä¸ºæ•´ä½“çš„è‰ºæœ¯\\", class:\\"right\\"}),\\ndom({tag:\\"p\\", child:\\"å¹»æƒ³è½¯ä»¶ç ”ç©¶@2022\\", class:\\"right\\"}),\\n\\"é¦–å…ˆï¼Œè®©æˆ‘è§£é‡Šä¸€ä¸‹è¿™ä¸ªé¡µé¢çš„åŠŸèƒ½ï¼Œè¿™æ˜¯ä¸€ä¸ªæ²™ç›’ç¯å¢ƒï¼Œå·¦è¾¹æ˜¯ç¼–è¾‘å™¨ï¼Œå³è¾¹æ˜¯å¯¹åº”çš„é¡µé¢ã€‚\\", br(),\\n\\"æ²™ç›’ç¯å¢ƒæ„å‘³ç€ä½ åœ¨jsé‡Œåšçš„æ“ä½œä¸ä¼šå½±å“åˆ°æ²™ç›’ä¹‹å¤–çš„ä¸œè¥¿ï¼Œå°±åƒåœ¨ä¸€ä¸ªiframeé‡Œé‚£æ ·ï¼ˆè™½ç„¶å®é™…ä¸Šä¸æ˜¯iframeï¼‰ã€‚\\", br(), br(),\\n\\"è¿™æ ·ä¸€ä¸ªå·¥å…·ï¼Œå®ƒçš„ä¸€ç§ç®€å•çš„åº”ç”¨æ˜¯å†™æ–‡ç« ï¼Œå°±åƒæˆ‘ç°åœ¨åšçš„ä¸€æ ·ã€‚\\", br(),\\n\\"ä½¿ç”¨jsæ“ä½œdomï¼Œç¼–å†™æ ·å¼ï¼Œå……åˆ†è¿ç”¨æµè§ˆå™¨æä¾›çš„æ’ç‰ˆåŠŸèƒ½ã€‚\\", br(),\\n\\"å®é™…ä¸Šï¼Œè¿˜ä¸æ­¢äºæ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨jsç®€åŒ–è®¸å¤šé‡å¤çš„æ–‡æœ¬ç¼–è¾‘æ“ä½œã€‚\\", br(),\\n\\"ï¼ˆè¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆç¬¨çš„ä¾‹å­ï¼Œåªè¦ç†è§£åˆ°æˆ‘çš„æ„æ€å°±å¥½ï¼š\\", exb0, \\"ï¼‰\\", exd0, br(),\\n\\"ä¸è¿‡ç¼–å†™æ–‡æ¡£è¿™å¹¶ä¸æ˜¯è¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜ï¼Œæˆ‘æƒ³è®¨è®ºçš„æ˜¯ä¸€ä¸ªæ›´ä¸ªäººçš„é—®é¢˜:\\", br(),\\nb(\\"åˆ°åº•æœ‰æ²¡æœ‰ä¸€ç§ç†æ€§çš„è½¯ä»¶ç¼–å†™æ–¹å¼ï¼Ÿ\\"), br(),\\n\\"æˆ‘ä¸æƒ³è®¨è®ºç°æœ‰çš„è½¯ä»¶å·¥ç¨‹å®è·µï¼Œæˆ‘åªè°ˆè°ˆæˆ‘å¿ƒç›®ä¸­ç†æƒ³çš„è½¯ä»¶å¼€å‘åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ã€‚\\", br(),\\n\\"ä»»ä½•ç¨‹åºéƒ½æ˜¯ä»å°å‘å±•åˆ°å¤§çš„ï¼Œå†åºå¤§çš„ç¨‹åºï¼Œä¹Ÿæ˜¯åœ¨ä¸ªäººèƒ½å¤Ÿç†è§£çš„å°ºåº¦ä¸‹è¢«ä¿®æ”¹çš„ï¼ˆåªè¦è¿˜æ˜¯ç”±äººç±»æ¥è¿›è¡Œç¼–ç¨‹ï¼‰ï¼Œè¿™ä¸ªå°ºåº¦æ˜¯æˆ‘ä»¬èƒ½åŠ›çš„è¾¹ç•Œã€‚\\", br(),\\n\\"è¿™æ„å‘³ç€å¯¹äºæŸä¸€ä¸ªå…·ä½“çš„è½¯ä»¶åŠŸèƒ½ï¼Œè™½ç„¶å®ƒçš„å®ç°å¯èƒ½ä¾èµ–äº†éå¸¸å¤æ‚çš„åŸºç¡€åº“æˆ–è€…å…¶ä»–ç»„ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½æœ¬èº«çš„è®¾è®¡ä¸€å®šæ˜¯ç®€å•çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»æŠŠå®ƒçš„æ•´ä¸ªè®¾è®¡æ”¾åœ¨ä¸€ä¸ªäººçš„å¤§è„‘é‡Œã€‚\\", br(),\\n\\"åº”è¯¥å­˜åœ¨ä¸€ç§æ‰‹æ®µï¼Œè®©æˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªä»£ç åº“ä¸­æå–å‡ºæˆ‘ä»¬å½“å‰çœŸæ­£å…³å¿ƒçš„éƒ¨åˆ†ï¼Œå‘Šè¯‰å…¶ä»–äººï¼ˆä»¥åŠæˆ‘ä»¬è‡ªå·±ï¼‰ï¼Œå¯¹äºå½“å‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬è®¾è®¡äº†æ€æ ·çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠè¿™ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å¦‚ä½•è¢«è½¬æ¢ä¸ºä»£ç çš„ã€‚\\", br(),\\n\\"ä¸éš¾æƒ³è±¡ï¼Œä¸€æ—¦è¿™æ ·çš„å·¥å…·å˜ä¸ºç°å®ï¼Œé‚£ä¹ˆå¯¹äºä»»æ„çš„ä¸€ä¸ªè½¯ä»¶è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“ä¸ºè¯»è€…æä¾›å¤§é‡çš„å¯æ“ä½œå®ä¾‹ï¼Œè®©è¯»è€…äº²è‡ªä¿®æ”¹ï¼Œå‚ä¸åˆ°è½¯ä»¶çš„æ„å»ºè¿‡ç¨‹ä¸­æ¥ï¼Œè¿™æ˜¯ç°æœ‰çš„ä»»ä½•è½¯ä»¶å¼€å‘å·¥å…·æ‰€ä¸å…·å¤‡çš„èƒ½åŠ›ã€‚\\", br(),\\nbr(), \\"è¿™ç¯‡æ–‡ç« å°†å°è¯•å¦‚ä½•ä»æœ€ç®€å•çš„å·¥å…·å‡ºå‘ï¼ˆä¹Ÿå°±æ˜¯ç°åœ¨è¿™ä¸ªæ²™ç›’ç¯å¢ƒï¼‰ï¼Œæ„é€ å‡ºä¸€å¥—èƒ½å¤Ÿå®ç°è¿™ä¸€æ„¿æ™¯çš„å·¥å…·ã€‚\\"]})"},{"v":"style(document.documentElement, {width:\\"50%\\"}), style(document.body, {margin:\\"1em\\"})\\nelm(document.body, {child:[\\"è¿™ä¸ªç¨‹åºä¼šæ‰“å°å½“å‰ç½‘é¡µçš„å†…å­˜ç”¨é‡ï¼š\\", $.sw = dom({tag:\\"span\\"}), \\"MB\\", dom({tag:\\"br\\"}), \\"æ³¨æ„å¯èƒ½çš„å†…å­˜æ³„æ¼ğŸ˜®\\"]})\\nconst upd = () => sw.innerText=(performance.memory.usedJSHeapSize/1024/1024).toFixed(1); setInterval(upd, 100), upd()\\n//elm(document.body, {child:[dom({tag:\\"br\\"}), \\"è‡ªé¡µé¢å¯åŠ¨å¼€å§‹çš„äº‹ä»¶ï¼š\\", $.tm = dom({tag:\\"span\\"}), \\"s\\"]});\\n//($.f = () => (requestAnimationFrame(f), elm(tm, {innerText:(performance.now()).toFixed()})))()"},{"v":"style(document.documentElement, {width:\\"50%\\"}), style(document.body, {margin:\\"1em\\"})\\ncss(\\"pre\\", {fontFamily:\\"consolas\\", background:\\"#1d191d\\", color:\\"#cbd3d2\\"})\\ncss(\\"button\\", {verticalAlign:\\"bottom\\"})\\nconst mktag = t => $[t] = (...a) => dom({tag:t, child:a})\\n\\"h2 h3 p br pre b button\\".split(\\" \\").forEach(mktag)\\nconst a = (u, ...child) => elm(dom({tag:\\"a\\", child, href:u}), ()=>{})\\n\\nconst ctx = new AudioContext(), ack = [], ackf = [], acknf = []; let preosc\\nforin(ctx, (v, k) => (ack.push(k), (isfct(v)?ackf:acknf).push([k, v])))\\nconst anl = ctx.createAnalyser(), ank = []; forin(anl, (v, k) => ank.push([k, v]))\\nanl.connect(ctx.destination)\\n//anl.fftSize = 8192\\n\\ncss(\\".data\\", { overflowWrap: \\"anywhere\\", fontSize:10, margin:\\"1em 0\\" })\\nconst tdinfo = dom({ class:\\"data\\" }), cvsheight = 150\\nconst cvssty = { display:\\"block\\", width:\\"100%\\", height:cvsheight, margin:\\"1em 0\\" }\\nconst tdcvs = style(dom({tag:\\"canvas\\"}), cvssty)\\nconst fdcvs = style(dom({tag:\\"canvas\\"}), cvssty)\\n\\nconst exp0 = () => {\\n  const osc = ctx.createOscillator()\\n  osc.frequency.value = 440\\n  osc.connect(ctx.destination)\\n  osc.start()\\n  osc.stop(ctx.currentTime + 1)\\n}, exp1 = () => {\\n  const osc = ctx.createOscillator()\\n  osc.frequency.value = 440\\n  osc.connect(anl) // æ”¹ä¸ºè¿æ¥åˆ°åˆ†æå™¨èŠ‚ç‚¹\\n  osc.start()\\n  osc.stop(ctx.currentTime + 1)\\n}, exp2 = () => {\\n  const td = new Uint8Array(anl.frequencyBinCount)\\n  const draw = () => {\\n    requestAnimationFrame(draw)\\n    anl.getByteTimeDomainData(td)\\n    // ç¡®ä¿æ¯ä¸ªæ•°å­—éƒ½ä»¥ä¸‰ä½æ•°æ˜¾ç¤º\\n    const tdstr = \\"[\\" + [...td].map(v=>v.toString().padStart(3, \\"0\\")).join(\\",\\") + \\"]\\"\\n    elm(tdinfo, {innerText: tdstr})\\n  }\\n  draw()\\n}, sound = fr => {\\n  preosc?.stop()\\n  const osc = ctx.createOscillator()\\n  osc.connect(anl)\\n  osc.frequency.value = fr\\n  osc.start()\\n  osc.stop(ctx.currentTime + 1)\\n  preosc = osc\\n}\\nexp2()\\n\\nconst sndict = \\"A A# B C C# D D# E F F# G G#\\".split(\\" \\")\\nconst num2sn = (i, k = i%12, h = Math.floor(i/12)) => sndict[k] + (k > 2 ? h+1 : h)\\nconst mksd = i => sound(27.5*Math.pow(2, i / 12))\\n\\nelm(document.body, {child:[\\nh2(\\"é€‰ä¸€ä¸ªä»€ä¹ˆæ ·çš„ä¸»é¢˜?\\"), \\"å®é™…ä¸Šä»€ä¹ˆä¸»é¢˜éƒ½å¯ä»¥ï¼Œåœ¨å®é™…çš„ç¼–ç¨‹éœ€æ±‚çš„é©±åŠ¨ä¸‹ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šé‡åˆ°éœ€è¦æ‹“å±•ç¼–è¾‘å™¨åŠŸèƒ½çš„æƒ…å†µï¼Œåˆ°é‚£ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å†æ¥è®¨è®ºå¦‚ä½•å‡çº§å·¥å…·ã€‚\\", br(),\\n\\"æ—¢ç„¶ä»€ä¹ˆéƒ½å¯ä»¥å†™ï¼Œé‚£ä¹ˆæˆ‘é€‰ä¸ªäººæ¯”è¾ƒæ„Ÿå…´è¶£çš„Web Audioä½œä¸ºæ¥ä¸‹æ¥çš„ç¼–ç¨‹ä¸»é¢˜ã€‚\\", br(), br(),\\na(\\"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Audio_API\\", \\"Web Audioæ˜¯ä»€ä¹ˆï¼Ÿ\\"), br(), br(),\\n\\"è®©æˆ‘ç”¨new AudioContext()åˆ›å»ºä¸€ä¸ªWeb Audioä¸Šä¸‹æ–‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼š\\", br(), br(),\\n`{ ${ack.join(\\", \\")} }`, br(), br(),\\n\\"å¯èƒ½æœ‰ç‚¹å¤ªå¤æ‚äº†ï¼Œè®©æˆ‘ä»¬å…ˆå¿½ç•¥æ‰æ‰€æœ‰çš„å‡½æ•°ã€‚\\", br(), br(),\\n`{ ${acknf.map(([k, v]) => `${k}: ${v}`).join(\\", \\")} }`, br(), br(),\\n\\"å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸€äº›å»¶è¿Ÿï¼Œé‡‡æ ·ç‡ç›¸å…³çš„æ•°æ®ï¼Œä»¥åŠdestinationï¼Œè¿™ä¸ªæ˜¯æœ€å…³é”®çš„ï¼Œå®ƒä»£è¡¨äº†ä¸€ä¸ªweb audioèŠ‚ç‚¹ç½‘ç»œçš„è¾“å‡ºã€‚\\", br(), br(),\\n\\"è€Œå‡½æ•°é‡Œé¢æœ‰ä¸€å¤§å †éƒ½æ˜¯createå¼€å¤´çš„ï¼š\\", br(), br(),\\n\\"{ \\", ...ackf.map(([k], i) => dom({tag:\\"span\\", child:k + (i === ackf.length - 1 ? \\"\\" : \\", \\"),\\n  style:{color:k.startsWith(\\"create\\")?\\"#0b0\\":\\"\\"}})), \\" }\\", br(), br(),\\n\\"è¿™äº›å‡½æ•°å…¨éƒ¨éƒ½æ˜¯ç”¨æ¥åˆ›å»ºç‰¹å®šèŠ‚ç‚¹çš„ï¼Œå‰©ä¸‹çš„å°±åªæœ‰ä¸‰ä¸ªäº‹ä»¶è§¦å‘å™¨ç›¸å…³çš„å‡½æ•°ï¼Œä¸€ä¸ªè§£ç å‡½æ•°ï¼Œä»¥åŠå‡ ä¸ªçŠ¶æ€æ§åˆ¶å‡½æ•°ï¼ŒåŸºæœ¬ä¸Šä»åå­—ä¹Ÿèƒ½çŒœåˆ°å®ƒä»¬çš„ä½œç”¨äº†ã€‚\\", br(), br(),\\n\\"è®©æˆ‘ä»¬è¯•ç€ç»„è£…ä¸€ä¸ªèŠ‚ç‚¹ï¼š\\", dom({tag:\\"button\\", child:\\"â–¶\\", onclick:exp0}), pre(fct2str(exp0)),\\n`åˆ›å»ºèŠ‚ç‚¹ï¼Œè®¾ç½®å±æ€§ï¼Œè¿æ¥åˆ°è¾“å‡ºï¼Œæ’­æ”¾ï¼Œåœæ­¢ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç±»ä¼¼çš„æ¨¡å¼è¿›è¡Œæ“ä½œçš„ï¼ŒåŒºåˆ«åªåœ¨äºæ¯ä¸ªèŠ‚ç‚¹çš„å±æ€§å„ä¸ç›¸åŒã€‚`, br(), br(),\\n\\"ä¸€ç§æœ‰è¶£çš„éŸ³é¢‘åº”ç”¨æ˜¯åˆæˆå™¨ï¼Œè¦å®ç°å¯¹åˆæˆéŸ³è‰²çš„ç²¾ç»†è°ƒæ•´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›åŸºç¡€çš„éŸ³é¢‘å¯è§†åŒ–å·¥å…·ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å…ˆå®ç°ä¸€ä¸ªæ³¢å½¢æ˜¾ç¤ºå™¨å’Œä¸€ä¸ªé¢‘è°±åˆ†æå™¨ã€‚\\", br(), br(),\\n\\"åœ¨Web Audioé‡Œï¼Œå¯ä»¥ä½¿ç”¨AnalyserèŠ‚ç‚¹å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œåˆ†æï¼Œåˆ›å»ºä¸€ä¸ªAnalyserèŠ‚ç‚¹çœ‹çœ‹å…¶ä¸­çš„å†…å®¹ï¼š\\", br(), br(),\\n\\"{ \\", ...ank.map(([k, v], i) => dom({tag:\\"span\\", style:{color:isfct(v)?\\"#0b0\\":\\"\\"},\\n  child:k + (isfct(v)?\\"\\":`: ${v}`) + (i === ank.length - 1 ? \\"\\" : \\", \\") })), \\" }\\", br(), br(),\\n\\"åŒæ ·æœ‰ä¸å°‘å†…å®¹ï¼Œæˆ‘æŠŠå‡½æ•°å±æ€§ç”¨é¢œè‰²æ ‡è®°äº†å‡ºæ¥ï¼Œè¿˜æ˜¯æŒºç®€å•çš„ï¼Œå››ä¸ªç”¨äºè·å–åˆ†ææ•°æ®çš„getå‡½æ•°ï¼Œä¸¤ä¸ªè¿æ¥æ§åˆ¶å‡½æ•°ï¼Œä¸‰ä¸ªäº‹ä»¶ç»‘å®šå‡½æ•°ã€‚\\",\\n\\"å…¶ä¸­æœ€å…³é”®çš„å°±æ˜¯å‰é¢å››ä¸ªgetå‡½æ•°ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºè·å–éŸ³é¢‘çš„é¢‘åŸŸä¿¡æ¯å’Œæ—¶åŸŸä¿¡æ¯ï¼Œè®©æˆ‘ä»¬ç”¨requestAnimationFrameå°è¯•æ‰“å°å‡ºæ¯å¸§è·å–çš„ä¿¡æ¯ã€‚\\",\\npre(fct2str(exp2)), tdinfo, \\"å¯ä»¥çœ‹åˆ°ï¼Œå½“æ²¡æœ‰ä»»ä½•éŸ³é¢‘çš„æ—¶å€™ï¼Œä½¿ç”¨getByteTimeDomainDataè·å–åˆ°çš„æ—¶åŸŸä¿¡æ¯æ€»æ˜¯ä¸€ä¸ªç”±128æ„æˆçš„æ•°ç»„ã€‚\\",\\nbr(), \\"ç°åœ¨ï¼Œè®©æˆ‘ä»¬æŠŠä¸€ä¸ªæŒ¯è¡å™¨èŠ‚ç‚¹è¿æ¥åˆ°åˆ†æå™¨èŠ‚ç‚¹ä¸Šï¼Œå¹¶æ’­æ”¾ä¸€äº›å£°éŸ³ï¼š\\",\\ndom({tag:\\"button\\", child:\\"â–¶\\", onclick:() => exp1()}), pre(fct2str(exp1)),\\n\\"æ•°ç»„çš„å†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œè¯´æ˜éŸ³é¢‘çš„å†…å®¹æ­£ç¡®åœ°é€šè¿‡äº†åˆ†æå™¨ï¼Œè¿™å¾ˆå¥½ã€‚\\",\\n\\"ä¸è¿‡ï¼Œè¿™è¿˜ä¸èƒ½ç§°ä¹‹ä¸ºä¸€ä¸ªå¾ˆå¥½çš„å¯è§†åŒ–ï¼Œå› ä¸ºæ•°å­—çš„å†…å®¹å˜åŒ–å¾—å¤ªå¿«äº†ï¼Œä»¥è‡³äºæˆ‘ä»¬æ ¹æœ¬ä¸çŸ¥é“å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆã€‚\\",\\n\\"æ›´å¥½çš„æ–¹å¼æ˜¯å°†æ³¢å½¢æ•°æ®ç»˜åˆ¶åˆ°canvasï¼š\\",\\n($.exp3 = (cvs, whichdata = \\"time\\") => {\\n  const length = anl.frequencyBinCount, ist = whichdata === \\"time\\"\\n  const td = new Uint8Array(length), ctx = cvs.getContext(\\"2d\\")\\n  const draw = () => {\\n    requestAnimationFrame(draw)\\n    anl[ist ? \\"getByteTimeDomainData\\" : \\"getByteFrequencyData\\"](td)\\n    const { width, height } = tdcvs, slice = width * 1.0 / length\\n    ctx.fillStyle = \\"#ccc\\", ctx.fillRect(0, 0, width, height)\\n    ctx.strokeStyle = \\"#111\\", ctx.beginPath()\\n    for (let i = 0; i < length; i++) {\\n      const v = (ist ? td[i] : 256 - td[i]) / 128\\n      const x = i * slice, y = v * (height-20) / 2 + 10\\n      ctx[i === 0 ? \\"moveTo\\" : \\"lineTo\\"](x, y)\\n    } ctx.stroke()\\n  }\\n  draw()\\n}, exp3(tdcvs, \\"time\\"), pre(fct2str(exp3))), \\"æ•ˆæœå¦‚ä¸‹ï¼š\\", tdcvs,\\n\\"åŒç†ï¼Œç»˜åˆ¶å‡ºé¢‘åŸŸä¿¡æ¯ï¼š\\", (exp3(fdcvs, \\"frequency\\"), fdcvs), \\"ç”¨é’¢ç´ä¸Šçš„88é”®æ¥å°è¯•ä¸€ä¸‹ï¼š\\", br(),\\n...maprg(88, i => dom({ tag:\\"button\\", innerText:num2sn(i), onpointerdown:() => mksd(i),\\n  onpointerenter: () => pointerdown ? mksd(i) : 0 })), br(), br(),\\n\\"çœ‹èµ·æ¥å¯è§†åŒ–å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼Œä½†ç”¨æ¥æµ‹è¯•å£°éŸ³çš„é”®ç›˜è¿˜æœ‰ä¸€äº›é—®é¢˜ã€‚\\",\\n\\"ä½ ä¹Ÿè®¸å·²ç»æ³¨æ„åˆ°äº†ï¼Œåœ¨æ¯ä¸ªéŸ³å¯åŠ¨å’Œç»“æŸçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿä¸€äº›é¢å¤–çš„å™ªéŸ³ã€‚\\",\\n\\"åœ¨æ³¢å½¢å›¾ä¸­ä¹Ÿèƒ½è§‚å¯Ÿåˆ°ï¼Œå½“äº§ç”Ÿå™ªéŸ³æ—¶ï¼Œæ³¢å½¢å°±ä¼šå‡ºç°æˆªæ–­ï¼Œè¯´æ˜è¿™ä¸ªæˆªæ–­å°±æ˜¯å™ªéŸ³äº§ç”Ÿçš„åŸå› ã€‚\\", br(), br(),\\n\\"é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•æ¶ˆé™¤æ‰è¿™ä¸ªå™ªéŸ³å‘¢ï¼Ÿ\\", br(),\\n\\"è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹ï¼Œæ—¢ç„¶äº§ç”Ÿå™ªéŸ³çš„åŸå› æ˜¯æ³¢å½¢å‡ºç°æˆªæ–­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æƒ³åŠæ³•è®©æ¯ä¸ªéŸ³çš„å¼€å§‹å’Œç»“æŸå°½å¯èƒ½å¹³æ»‘ï¼Œä¹Ÿå°±æ˜¯ä½¿éŸ³é‡å¤§å°å‘ˆç°å‡ºè¿™æ ·çš„å˜åŒ–ï¼š\\", br(),\\ndom({tag:\\"svg\\", child:[\\ndom({tag:\\"text\\", child:\\"åˆšå¼€å§‹æŒ‰é”®æ—¶è¿‡æ¸¡åˆ°æœ€å¤§éŸ³é‡\\", x:20, y:120}),\\ndom({tag:\\"text\\", child:\\"æŒ‰ä½æ—¶ç»´æŒéŸ³é‡\\", x:100, y:42}),\\ndom({tag:\\"text\\", child:\\"æ¾å¼€æ—¶é€æ¸è¡°å‡åˆ°éŸ³é‡ä¸º0\\", x:250, y:120}),\\ndom({tag:\\"text\\", fill:\\"green\\", child:\\"å¯¹äºé”®ç›˜ä¸Šçš„æ¯ä¸ªéŸ³éƒ½è¿™æ ·æ“ä½œ\\", x:290, y:70}),\\ndom({tag:\\"polyline\\", fill:\\"none\\", stroke:\\"black\\",\\n  points:`50,100 100,50 200,50 250,100`}),\\ndom({tag:\\"polyline\\", fill:\\"none\\", stroke:\\"green\\", transform:\\"translate(30,0)\\",\\n  points:`50,100 100,50 200,50 250,100`}),\\ndom({tag:\\"polyline\\", fill:\\"none\\", stroke:\\"blue\\", transform:\\"translate(60,0)\\",\\n  points:`50,100 100,50 200,50 250,100`}),\\n], width:600}), br(), \\"ä½¿ç”¨gainèŠ‚ç‚¹å¾ˆå®¹æ˜“å®ç°è¿™æ ·çš„æ•ˆæœï¼š\\",\\n($.exp4 = (fr, st) => {\\n  const t = 0.01\\n  const osc = ctx.createOscillator()\\n  const gain = ctx.createGain()\\n\\n  osc.connect(gain)\\n  gain.connect(anl)\\n\\n  // å…ˆå°†éŸ³é‡è®¾ä¸º0ï¼Œåœ¨0.01ç§’ä¹‹å†…è¿‡æ¸¡åˆ°1\\n  gain.gain.value = 0\\n  gain.gain.linearRampToValueAtTime(1, ctx.currentTime + t)\\n\\n  osc.frequency.value = fr\\n  osc.start(st)\\n\\n  // è¿”å›ä¸€ä¸ªç”¨äºåœæ­¢æ’­æ”¾çš„å‡½æ•°\\n  return () => {\\n    const st = ctx.currentTime + t\\n    gain.gain.value = gain.gain.value\\n    gain.gain.linearRampToValueAtTime(0, st)\\n    setTimeout(() => gain.disconnect(), t*1000+10)\\n  }\\n}, $.keysound2 = {}, $.mksd2 = (i, t = ctx.currentTime) => {\\n  stpsd2(i)\\n  return keysound2[i] = exp4(27.5*Math.pow(2, i / 12))\\n}, $.stpsd2 = i => { keysound2[i]?.() }, pre(fct2str(exp4))), \\"æµ‹è¯•ä¸€ä¸‹ï¼š\\", br(),\\n...maprg(88, i => elm(button(num2sn(i)), {\\n  onpointerdown:() => mksd2(i),\\n  onpointerup:() => stpsd2(i),\\n  onpointerenter: () => pointerdown ? mksd2(i) : 0,\\n  onpointerleave: () => stpsd2(i),\\n})), br(), br(),\\n\\"ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿åªè®¾ç½®ä¸€ä¸ªå¾ˆçŸ­çš„è¿‡æ¸¡æ—¶é—´ï¼Œä¹Ÿèƒ½èµ·åˆ°æ¶ˆé™¤å™ªéŸ³çš„ä½œç”¨ï¼Œè¯´æ˜è¿™ä¸ªè¿‡æ¸¡æ—¶é—´å¯¹äºéŸ³é¢‘åˆæˆæ¥è®²éå¸¸é‡è¦ã€‚\\",\\ndom({class:\\"spbar\\"}),\\n\\"ç°åœ¨æˆ‘ä»¬å·²ç»ç¼–å†™äº†ä¸€ä¸ªéå¸¸ç®€é™‹çš„åˆæˆå™¨ï¼Œå¯ä»¥é€šè¿‡æŒ‰é’®æ¥å¼¹ä¸€äº›ç®€å•çš„æ›²å­äº†ï¼Œä¸ºä½•ä¸æŠŠè¿™ä¸ªè¿‡ç¨‹è‡ªåŠ¨åŒ–ä¸€ä¸‹å‘¢ï¼Ÿ\\", br(), br(),\\n\\"è¯•ç€åˆ†æä¸€ä¸‹ï¼Œå¦‚æœæƒ³è¦è‡ªåŠ¨åŒ–è¿™ä¸ªæ¼”å¥çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±éœ€è¦å‘Šè¯‰ç¨‹åºåœ¨ä»€ä¹ˆæ—¶é—´æ¼”å¥ä»€ä¹ˆéŸ³ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–‡æœ¬æ¥ç¼–ç è¿™äº›ä¿¡æ¯ï¼Œå°±åƒè¿™æ ·ï¼š\\",\\npre(\\"C3 C3 G3 G3 A3 A3 G3\\\\nï¼ˆå°æ˜Ÿæ˜Ÿçš„ç¬¬ä¸€å¥ï¼‰\\\\nï¼ˆä½ å¯èƒ½æ³¨æ„åˆ°è¿™é‡Œé¢è¿˜æ²¡æœ‰ç¼–ç èŠ‚å¥ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™ä¸ªç•™åˆ°åé¢è€ƒè™‘ï¼‰\\"),\\n\\"è®©æˆ‘ä»¬æŒ‰è¿™ä¸ªæ€è·¯å°è¯•è®¾è®¡ä¸€ä¸ªæ–‡æœ¬å½¢å¼éŸ³ç¬¦çš„è§£æå™¨ï¼ˆä»¥åŠç›¸åº”çš„éŸ³åºå™¨ï¼‰ï¼š\\",\\n($.playsoundat = mksd2, $.exp5 = () => {\\n  const snarr = \\"A A# B C C# D D# E F F# G G#\\".split(\\" \\")\\n  const num2sn = (i, k = i%12, h = Math.floor(i/12)) => sndict[k] + (k > 2 ? h+1 : h)\\n  const sndct = {}; forrg(88, i => sndct[num2sn(i)] = i)\\n  const parse = i => i.trim().split(/\\\\s+/).map(v => v.toUpperCase())\\n    .map(v => v in sndct ? sndct[v] : panic(`unknown sound name: \\"${v}\\"`))\\n\\n  const bpm = 120, dt = 60 / bpm\\n  return (i, notes = parse(i)) => {\\n    let t = ctx.currentTime, stop\\n    const pollnote = () => {\\n      while(t <= ctx.currentTime + 0.1) {\\n        const n = notes.shift(); if(!n) { stop?.(); return }\\n        stop?.(), stop = playsoundat(n, t), t += dt // åœæ­¢ä¸Šä¸€ä¸ªéŸ³ï¼Œæ’­æ”¾å½“å‰éŸ³\\n      } setTimeout(pollnote, 50)\\n    }; pollnote()\\n  }\\n}, $.pssd1 = exp5(), $.littlestar1 =\\n`c4 c4 g4 g4 a4 a4 g4 f4 f4 e4 e4 d4 d4 c4\\ng4 g4 f4 f4 e4 e4 d4 g4 g4 f4 f4 e4 e4 d4\\nc4 c4 g4 g4 a4 a4 g4 f4 f4 e4 e4 d4 d4 c4`, pre(fct2str(exp5))),\\n\\"ç”¨å°æ˜Ÿæ˜Ÿæµ‹è¯•ä¸€ä¸‹è¿™ä¸ªç®€å•çš„éŸ³åºå™¨ï¼š\\", elm(button(\\"â–¶\\"), {onclick: () => pssd1(littlestar1)}),\\nbr(), \\"æˆ–è€…æ˜¯æ¼”å¥ä½ è‡ªå®šä¹‰çš„åºåˆ—ï¼š\\", elm(button(\\"â–¶\\"), { onclick: () => trycatch(() => pssd1(sqsdta1.value)) }), br(),\\n$.sqsdta1 = dom({ tag: \\"textarea\\", value: littlestar1 }), br(), br(),\\n\\"ä¸ºäº†è¿›ä¸€æ­¥æ‹“å±•éŸ³åºå™¨çš„åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬ä»”ç»†æ€è€ƒä¸€ä¸‹éŸ³åºå™¨çš„ä»£ç ã€‚ç°åœ¨è¿™ä¸ªéŸ³åºå™¨çš„åŸºæœ¬é€»è¾‘æ˜¯ï¼š\\", br(),\\nb(\\"å½“ä¸€ä¸ªéŸ³åº”å½“å‘ç”Ÿåœ¨æœªæ¥0.1sç§’ä¹‹å†…çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªéŸ³è§„åˆ’åˆ°web audioçš„å‘éŸ³é˜Ÿåˆ—é‡Œã€‚\\"), br(),\\n\\"æ ¸å¿ƒé€»è¾‘æ˜¯æ²¡é—®é¢˜çš„ï¼Œä¸è¿‡å…·ä½“å®ç°ä¸Šè¿˜æœ‰ä¸€äº›ä¸è¶³ï¼š\\", br(),\\n\\"æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯¹éŸ³ç¬¦å‘ç”Ÿæ—¶é—´çš„è®¡ç®—æ˜¯å‘ç”Ÿåœ¨pollnoteçš„å¾ªç¯é‡Œçš„ï¼Œå®é™…ä¸Šå®Œå…¨å¯ä»¥é¢„å…ˆç®—å‡ºæ¯ä¸ªéŸ³ç¬¦çš„å¯åŠ¨æ—¶é—´ã€‚\\", br(),\\n\\"ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠå¯åŠ¨æ—¶é—´å½“ä½œä¸€ä¸ªéŸ³ç¬¦çš„æ ¸å¿ƒå±æ€§ã€‚æ›´è¿›ä¸€æ­¥åœ°ï¼Œæˆ‘ä»¬å¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ª\\", b(\\"éŸ³é¢‘äº‹ä»¶\\"), \\"çš„æ¦‚å¿µï¼š\\", br(),\\n\\"å®ƒçš„æ•°æ®ä¸­æœ‰ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œ\\", b(\\"ä¸€æ˜¯äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ï¼ŒäºŒæ˜¯å¯¹web audioä¸Šä¸‹æ–‡çš„æ“ä½œã€‚\\"), br(),\\n\\"ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ¯ä¸ªéŸ³ç¬¦å‘ç”Ÿæ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»å¯åŠ¨å¼€å§‹åˆ°éŸ³ç¬¦ç»“æŸçš„æ‰€æœ‰éŸ³é¢‘æ“ä½œéƒ½æ’è¿›web audioçš„è®¡åˆ’è¡¨ã€‚\\", br(),\\n\\"å®é™…ä¸Šï¼Œæ‰€æœ‰çš„éŸ³é¢‘æ“ä½œéƒ½å¯ä»¥ä»¥è¿™ç§å½¢å¼è¢«æŠ½è±¡å‡ºæ¥ï¼ŒåŒ…æ‹¬å„ç§å¯¹å±æ€§çš„åŒ…ç»œçº¿æ“ä½œï¼Œåé¢å®ç°è¿™äº›åŠŸèƒ½çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™ä¸ªæŠ½è±¡çš„ç®€æ´å¼ºå¤§ã€‚\\", br(),\\ndom({class:\\"spbar\\"}),\\n\\"åœ¨ä¸Šé¢çš„åˆ†æä¸­ï¼Œæˆ‘ä»¬ï¼ˆè‡³å°‘åœ¨æ¦‚å¿µä¸Šï¼‰è§£å†³äº†éŸ³åºå™¨çš„è®¾è®¡é—®é¢˜ï¼Œä½†æ˜¯è¿˜æœ‰å¦ä¸€ä¸ªå¾ˆå…³é”®çš„éƒ¨åˆ†ï¼Œé‚£å°±æ˜¯ç”¨äºç¼–ç æ¼”å¥ä¿¡æ¯çš„è¯­è¨€ã€‚\\", br(),\\n\\"åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œæˆ‘å†™äº†ä¸€ä¸ªéå¸¸ç®€é™‹çš„æè¿°è¯­è¨€ï¼Œå®ƒåªèƒ½åŒ¹é…ç¼–ç å¥½çš„å›ºå®šçš„88ä¸ªéŸ³åï¼Œé™¤æ­¤ä¹‹å¤–çš„ä»»ä½•ä¸œè¥¿éƒ½è¢«è§†ä¸ºé”™è¯¯ã€‚\\", br(),\\n\\"è¿™æ ·çš„ä¸€ä¸ªè¯­è¨€ï¼Œé¦–å…ˆç”¨æˆ·ä½“éªŒè¯´ä¸ä¸Šæœ‰å¤šå¥½ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå¾ˆéš¾è¢«æ‹“å±•ã€‚\\", br(),\\n\\"æˆ‘è®¤ä¸ºéœ€è¦æ›´æ­£å¼åœ°æ€è€ƒä¸€ä¸‹è¿™ä¸ªè¯­è¨€çš„è®¾è®¡é—®é¢˜ï¼Œå› æ­¤ï¼Œå¯¹äºweb audioçš„æ¢ç´¢æš‚å‘Šä¸€æ®µè½ï¼Œå…ˆè®©æˆ‘ä»¬å›åˆ°å¯¹æ–‡å­¦ç¼–ç¨‹çš„æ€è€ƒä¸Šã€‚â–¯\\"\\n]})\\n\\nstyle(sqsdta1, { height: sqsdta1.value.split(/\\\\r?\\\\n/).length * 20 })\\ncss(\\"textarea\\", { width:\\"100%\\", lineHeight:20, fontSize:\\"1em\\", fontFamily:\\"consolas\\" })\\ncss(\\".spbar\\", {width:\\"calc(100% - 2em)\\", margin:\\"1em\\", height:1, backgroundColor:\\"black\\"})\\n\\naddEventListener(\\"resize\\", () => {\\n  tdcvs.width = tdcvs.clientWidth * devicePixelRatio\\n  tdcvs.height = cvsheight * devicePixelRatio\\n  fdcvs.width = tdcvs.clientWidth * devicePixelRatio\\n  fdcvs.height = cvsheight * devicePixelRatio\\n}); let pointerdown\\naddEventListener(\\"pointerdown\\", () => pointerdown = true)\\naddEventListener(\\"pointerup\\", () => pointerdown = false)"},{"v":"style(document.documentElement, {width:\\"50%\\"}), style(document.body, {margin:8})\\nconst mktag = t => $[t] = (...a) => dom({tag:t, child:a}), lh = 20\\n\\"h2 p br pre b ul ol li span div\\".split(\\" \\").forEach(mktag)\\n$.ta = (v = \\"\\") => dom({ tag: \\"textarea\\", spellcheck: false, value: v })\\n$.code = (v = \\"\\", e = true) => (\\n  isfct(v) ? (e ? setTimeout(v) : 0, v = fct2str(v)): 0, dom({ class: \\"code\\", innerText: v }))\\ncss(\\".spbar\\", {width:\\"calc(100% - 2em)\\", margin:\\"1em\\", height:1, backgroundColor:\\"black\\"})\\n\\nconst codefont = { lineHeight: lh, fontSize: \\"1em\\", fontFamily: \\"consolas\\", whiteSpace: \\"pre-wrap\\" }\\ncss(\\".code, .test\\", codefont, { background:\\"#1d191d\\", color:\\"#cbd3d2\\"},\\n  { margin: \\"0.2em 0\\", padding: \\"0.2em 0\\", paddingLeft: \\"2em\\" })\\ncss(\\".accident\\", {color:\\"red\\"})\\nstyle(document.body, { margin: \\"1em\\" }); css(\\"ul, ol\\", { margin: 0 })\\n\\nelm(document.body, {child:[\\nh2(\\"æ–‡å­¦ç¼–ç¨‹åŠŸèƒ½çš„é˜¶æ®µæ€§æ€»ç»“\\"), \\"ä¸Šé¢çš„æ–‡ç« ç§¯ç´¯äº†ä¸€äº›æ–‡å­¦ç¼–ç¨‹çš„æ¡ˆä¾‹ï¼Œç°åœ¨è¯•ç€æ€»ç»“ä¸€ä¸‹æˆ‘ä»ä¸­ç†è§£åˆ°çš„ä¸œè¥¿ï¼š\\",\\nul(li(\\"åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘å°†æ–‡ç« çš„å†…å®¹å…¨éƒ¨ç¼–ç åœ¨DOMæ“ä½œé‡Œï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨æ–‡ç« ä¸­ç¼–å†™ä»»ä½•ç¨‹åºï¼Œä½†æ˜¯ä¹Ÿé€ æˆäº†ä¸€äº›é—®é¢˜ï¼š\\",\\nul(li(\\"æ–‡ç« å†…å®¹å’Œç¨‹åºçš„å¯¹åº”å…³ç³»ä¸æ˜æ˜¾ï¼Œé€šå¸¸è¦åœ¨ç¨‹åºé‡Œè¿›è¡Œä¸€äº›å®šä½æ‰çŸ¥é“è¦åœ¨å“ªé‡Œä¿®æ”¹å¯¹åº”çš„æ–‡ç« æ®µè½ã€‚\\"),\\n   li(\\"æ–‡ç« ä¸­æ’å…¥çš„ç¨‹åºæ®µä¸å…¨å±€ç¯å¢ƒçš„è”ç³»å®Œå…¨æ²¡æœ‰ç»™å‡ºã€‚\\")),\\nli(\\"è¿˜æœ‰ä¸€äº›é¢å¤–çš„æƒ³æ³•ï¼š\\", ul(li(\\"ä¸Šé¢çš„ä¾‹å­ä¸­å®ç°äº†ä¸€ä¸ªéŸ³é¢‘å¯è§†åŒ–çš„å·¥å…·ï¼Œæˆ‘å¸Œæœ›å¯ä»¥è®©å®ƒå…·æœ‰ç±»ä¼¼position:stickyçš„æ ·å¼\\",\\n\\"ï¼Œä½†æ˜¯position:stickyéœ€è¦çˆ¶çº§å®¹å™¨æœ¬èº«å­˜åœ¨scrollï¼Œå’Œç°åœ¨çš„è®¾è®¡å¹¶ä¸å…¼å®¹ï¼ˆä¹Ÿè®¸è¦ç­‰å®ç°å®Œæ•´çš„æ–‡æ¡£æ¸²æŸ“å™¨æ‰èƒ½åšå¾—æ¯”è¾ƒå®Œç¾ï¼‰ã€‚\\"),\\nli(\\"éœ€è¦æŸç§ç¨‹åº¦çš„ç»„ä»¶ç¼–è¾‘å™¨ï¼Œç”¨äºå®ç°è‡ªå®šä¹‰æ ‡ç­¾ï¼ˆä¸¾ä¾‹ï¼šä¸Šä¸€æ®µæ–‡ç« ä¸­å†™çš„æ•°æ®å¯è§†åŒ–å™¨ï¼Œä»¥åŠè™šæ‹Ÿé’¢ç´é”®ç›˜éƒ½å¯ä»¥ä½œä¸ºè‡ªå®šä¹‰æ ‡ç­¾ï¼‰ã€‚\\"),\\nli(\\"æ–‡æœ¬ç¼–è¾‘çš„ä½“éªŒå¤ªå·®äº†ï¼ˆæ°¸è¿œçš„é—®é¢˜ï¼‰ã€‚\\")),\\n))),\\n\\"è¿™æ ·æ€»ç»“äº†ä¸€ä¸‹ï¼Œçœ‹èµ·æ¥è¿™äº›é—®é¢˜æ˜¯æœ‰ä¸€äº›å†…åœ¨çš„é‡åˆçš„ï¼Œå¦‚æœæˆ‘å°è¯•å»ç¼–å†™æ–‡æœ¬ç¼–è¾‘å™¨çš„è¯ï¼Œè¯´ä¸å®šå¯ä»¥æŠŠå¥½å‡ ä¸ªé—®é¢˜æ”¾åœ¨ä¸€èµ·è§£å†³ã€‚\\", br(), br(),\\n\\"é‚£ä¹ˆå°±å¼€å§‹ç¼–å†™æ–‡æœ¬ç¼–è¾‘å™¨ã€‚\\", dom({class:\\"spbar\\"}), \\"é¦–å…ˆå®šä¹‰è®¾è®¡ç›®æ ‡ï¼š\\", \\nul(li(\\"è¿™ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨çš„è®¾è®¡ç›®çš„æ˜¯æ›¿æ¢æ‰é»˜è®¤çš„textareaï¼Œæ‰€ä»¥ä¸éœ€è¦ç‰¹åˆ«é«˜çº§çš„æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ã€‚\\"),\\n  li(\\"éœ€è¦æ”¯æŒç¼©è¿›ï¼Œé€‰æ‹©ï¼Œå¯ä»¥çš„è¯æ”¯æŒä¸€ä¸‹å¤šå…‰æ ‡ç¼–è¾‘ã€‚\\"),\\n  li(\\"åœ¨ç”¨æˆ·æ€å®Œæˆæ–‡æœ¬ç¼–è¾‘å™¨æ‰€æœ‰ä»£ç çš„ç¼–å†™ï¼Œä¹Ÿå°±æ˜¯è¯´å·¦è¾¹çš„ä»£ç åªè´Ÿè´£ç¼–å†™æ–‡æ¡£ï¼Œå®é™…çš„åŠŸèƒ½è¦åœ¨å³è¾¹çš„ç¼–è¾‘å™¨é‡Œå®Œæˆã€‚\\"),\\n  li(\\"å°†ç¼–è¾‘å™¨å®ç°ä¸ºè‡ªå®šä¹‰æ ‡ç­¾ï¼Œæµ‹è¯•åˆ›å»ºä½œç”¨åŸŸçš„æµç¨‹ã€‚\\"),\\n  li(\\"å®Œæˆç¼–è¾‘å™¨ä¹‹åè®¾æ³•æ›¿æ¢æ‰å·¦è¾¹çš„ç¼–è¾‘å™¨ï¼Œé€æ¸æå‡æ•´ä¸ªå·¥å…·çš„ä½“éªŒã€‚\\")), dom({class:\\"spbar\\"}),\\n\\"æ¥ä¸‹æ¥ï¼Œç¡®å®šä¸€ä¸‹è¿è¡Œä»£ç çš„æµç¨‹ã€‚\\",\\ncode(() => {\\n// $æ˜¯å…¨å±€ç©ºé—´çš„åå­—ï¼Œç”±äºjsçš„ä¸€äº›é™åˆ¶ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ç§æ–¹å¼ä¿®æ”¹å…¨å±€ç©ºé—´ä¸­çš„å˜é‡\\n$.sum = (a, b) => a + b\\n}),\\n\\"è¿›è¡Œä¸€äº›æµ‹è¯•ï¼š\\", code(() => {\\n$.bs = b => b ? \\"âœ…\\" : \\"âŒ\\"\\n$.test = f => [span(bs(f())), \\" \\", String(f)]\\n// rs1æ˜¯ç”¨æ¥æ‰“å°æµ‹è¯•ç»“æœçš„æ ‡ç­¾çš„å˜é‡å\\nelm(rs1, {child:[ li(...test(() => sum(1, 1) === 2)),\\n  li(...test((a = Math.random(), b = Math.random()) => sum(a, b) === a + b)) ]})\\n}), \\"å°†æµ‹è¯•ç»“æœæ‰“å°å‡ºæ¥ï¼š\\", $.rs1 = elm(ul(), {class:\\"test\\"}), dom({class:\\"spbar\\"}),\\n\\"ç°åœ¨ï¼Œè€ƒè™‘ä¸€ä¸ªæœ€ç®€å•çš„æ–‡æœ¬ç¼–è¾‘çš„æƒ…å½¢â€”â€”ç¼–è¾‘å•è¡Œæ–‡æœ¬ï¼š\\", br(),\\n\\"é¦–å…ˆä½¿ç”¨ä¸€ä¸ªtextareaç›‘å¬ç”¨æˆ·çš„æ‰€æœ‰é”®ç›˜è¾“å…¥:\\", br(),\\ncode(() => {\\nlet dkeys = new Set, ipt = {}\\nconst onkeydown = e => (dkeys.add(e.key), update())\\nconst onkeyup = e => (dkeys.delete(e.key), update())\\nconst oninput = e => (ipt = e, textarea.value = \\"\\")\\nconst update = () => elm(rs3, { innerHTML:\\"\\", child: [\\n  \\"å½“å‰è¾“å…¥å†…å®¹ï¼š\\", ipt.data ?? \\"<ç©º>\\", br(),\\n  \\"æ˜¯å¦ä¸ºIMEï¼š\\", bs(ipt.isComposing), br(),\\n  \\"å½“å‰æŒ‰ä¸‹çš„æŒ‰é’®ï¼š\\", dkeys.size === 0 ? \\"<ç©º>\\" : [...dkeys].map(v => v === \\" \\" ? \\"Space\\" : v).join(\\" \\"),\\n]})\\nconst textarea = elm(ta(), { onkeydown, onkeyup, oninput, style:{display:\\"block\\"} })\\n// å°†å ä½ç¬¦rs2æ›´æ¢ä¸ºtextarea\\nswaptag(\\"\\", rs2, textarea)\\nupdate()\\n}),\\n\\"ä¸Šé¢çš„ä»£ç å°†åœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªtextareaï¼š\\", br(), $.rs2 = dom(),\\n$.rs3 = dom(), dom({class:\\"spbar\\"}),\\n\\"ä¸‹ä¸€æ­¥ï¼Œè®©æˆ‘ä»¬å®ç°æ–‡æœ¬æ˜¾ç¤ºä»¥åŠå…‰æ ‡ï¼š\\", br(),\\ncode(() => {\\nconst text = \\"0123456789\\".repeat(100)\\nelm(rs4, {child: [$.txt1 = div(text), $.csr1 = div()], style:{overflow:\\"hidden\\",\\n  width:\\"100%\\", position:\\"relative\\", boxSizing:\\"border-box\\"}, class:\\"code\\"})\\nstyle(csr1, {position:\\"absolute\\", width:2, height:lh, top:\\"0.2em\\", background:\\"#cbd3d2\\"})\\n}), \\"ä¸Šé¢çš„ä»£ç ç”Ÿæˆäº†ä¸€æ®µæµ‹è¯•æ–‡æœ¬ä»¥åŠä¸€ä¸ªç”¨äºè¡¨ç¤ºå…‰æ ‡çš„divæ ‡ç­¾ï¼š\\", $.rs4 = dom(), br(),\\n\\"ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„é—®é¢˜æ˜¯ï¼Œç”±äºæˆ‘ä»¬ä¸çŸ¥é“ä¸€æ®µæ–‡æœ¬çš„å…·ä½“å®½åº¦ï¼Œå› æ­¤æ— æ³•å®ç°å¯¹å…‰æ ‡çš„ç§»åŠ¨ã€‚\\", br(),\\n\\"æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æŸç§æµ‹é‡æ–‡æœ¬é•¿åº¦çš„æ‰‹æ®µï¼Œä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨Rangeå¯¹è±¡ï¼š\\",\\ncode(() => {\\nconst measure_range = () => {\\n  const sel = getSelection()\\n  if(!sel.rangeCount) { return }\\n  const range = sel.getRangeAt(0)\\n  const { width, height } = range.getBoundingClientRect()\\n  elm(rs5, {innerText: `å½“å‰é€‰æ‹©åŒºåŸŸçš„å®½åº¦ä¸º${width}ï¼Œé«˜åº¦ä¸º${height}ã€‚`})\\n}\\nmeasure_range()\\naddEventListener(\\"pointermove\\", measure_range)\\n}), \\"ä¸Šé¢çš„å‡½æ•°ä»å½“å‰çª—å£é‡Œçš„é€‰æ‹©åŒºåŸŸåˆ›å»ºRangeå¯¹è±¡ï¼Œä»è€Œè·å–å…¶é•¿å®½ï¼š\\", rs5 = span(), br(),\\ndom({class: \\"accident\\", child: [\\n  \\"å‘ç”Ÿäº†æ„å¤–ï¼šä¸Šé¢è¿™æ®µä»£ç æ²¡æœ‰æ­£å¸¸å·¥ä½œï¼Œåªæœ‰åœ¨æå°‘æ•°çš„æƒ…å†µæ‰èƒ½æµ‹é‡å‡ºç»“æœï¼ŒåŸå› æœªçŸ¥ã€‚\\", br(),\\n  \\"è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºè·å–rangeé•¿å®½çš„æ–¹æ³•æ˜¯getBoudingClientRectï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»…å½“æµ‹é‡çš„å¯¹è±¡æ²¡æœ‰å‘ç”Ÿç¼©æ”¾æ—¶ï¼Œæµ‹é‡ç»“æœæ‰æ˜¯æ­£ç¡®çš„ã€‚\\", br(),\\n  \\"ç»æµ‹è¯•ï¼Œä½¿ç”¨rangeæµ‹é‡å­—ç¬¦å®½åº¦çš„codemirrorç¼–è¾‘å™¨åœ¨æ•´ä¸ªå…ƒç´ ç¼©æ”¾ä¹‹åï¼Œå…¶å…‰æ ‡ä½ç½®ä¼šå‡ºç°é”™è¯¯ï¼Œè¿™è¯æ˜äº†ä¸Šè¿°æƒ³æ³•ã€‚\\",\\n  \\"ï¼ˆmonacoç¼–è¾‘å™¨ï¼ˆvscodeï¼‰æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½æ˜¯æ²¡æœ‰ä½¿ç”¨rangeè¿›è¡Œæµ‹é‡æˆ–è€…åšäº†ç‰¹æ®Šå¤„ç†ã€‚ï¼‰\\" ]}), br(),\\n\\"ç”±äºä¸Šé¢çš„æµ‹é‡æ–¹æ³•æœ‰ä¸€äº›é—®é¢˜ï¼Œè®©æˆ‘ä»¬æ¢ä¸€ç§æ€è·¯ï¼Œä½¿ç”¨canvasæä¾›çš„measureTextå‡½æ•°è¿›è¡Œæµ‹é‡ï¼š\\", br(),\\ncode(() => {\\nconst cvs = dom({tag:\\"canvas\\"}), ctx = cvs.getContext(\\"2d\\")\\nconst _tw = t => ctx.measureText(t).width, cache = {}\\nconst tw = (t, f) => (cache[f] ??= {})[t] ?? (cache[f][t] = _tw(t))\\n$.rawtextwidth = (t, f) => (ctx.font !== f ? ctx.font = f : 0, _tw(t))\\n$.textwidth = (t, f) => (ctx.font !== f ? ctx.font = f : 0,\\n  [...t].map(c => tw(c, f)).reduce((p, v) => p + v, 0))\\n}), \\"å†™ä¸ªæµ‹è¯•ç¨‹åºï¼š\\",\\ncode(() => {\\nconst {abs, random, floor} = Math, rtw = $.rawtextwidth, tw = $.textwidth\\n$.randstr = l => maprg(l, () => floor(random() * 0x0fff + 0x2000))\\n  .map(v => String.fromCharCode(v)).join(\\"\\")\\nlet font = `normal 16px consolas`, test = () => {\\n  const s = randstr(5), wr = rtw(s, font), w = tw(s, font)\\n  const r = abs(wr - w) < 0.1, eq = w > wr ? \\">\\" : w < wr ? \\"<\\" : \\"=\\", sp = style(span(s), {display:\\"inline-block\\"})\\n  const i = li(`${bs(r)}ï¼Œæµ‹è¯•å­—ç¬¦ä¸²ï¼š\\"`, sp, `\\"ï¼Œä½¿ç”¨ç¼“å­˜/ç›´æ¥æµ‹é‡ï¼š${w.toFixed(1)} ${eq} ${wr.toFixed(1)}`); wtcount(r)\\n  !r ? wrong.append(i) : elm(right, {child:[i],diff:true})\\n  const dw = sp.getBoundingClientRect().width.toFixed(1)\\n  elm(i, {child:`ï¼Œä»DOMæµ‹é‡ï¼š${dw}ï¼Œç›¸ç­‰ï¼š${bs(dw===wr.toFixed(1))}`})\\n  b ? id = setNow(test) : 0\\n}, b = true, id, wrong = ul(), right = ul(), ts = 0, suc = 0\\nconst rsty = {lineHeight:20, fontFamily:`consolas`, fontSize:16}\\nstyle(wrong, rsty), style(right, rsty)\\nconst toggle = () => ((b = !b) ? test() : clearNow(id),\\n  bt1.innerText = (b ? \\"æš‚åœ\\" : \\"å¯åŠ¨\\"))\\nconst clear = () => right.innerText = wrong.innerText = \\"\\"\\nconst bt1 = dom({tag:\\"button\\", onclick:toggle})\\nconst bt2 = dom({tag:\\"button\\", child:\\"æ¸…é™¤\\", onclick:clear})\\nconst count = span(), wtcount = (r = false, s = r ? ++suc : suc, i = ts++) =>\\n  count.innerText = ` å·²æµ‹è¯•ï¼š${s}/${i}æ¬¡ï¼Œæ­£ç¡®ç‡ï¼š${((s/i)*100).toFixed(1)}%`\\nelm(rs6, {child: [\\n  \\"éšæœºç”Ÿæˆä¸€äº›æµ‹è¯•ï¼Œç¡®è®¤ä½¿ç”¨ç¼“å­˜çš„textwidthå’ŒåŸæœ¬çš„measureTextè¾“å‡ºçš„ç»“æœä¸€è‡´ï¼š\\",\\n  br(), bt1, bt2, count, wrong, right]})\\ntoggle(), wtcount(0,0,0)\\n}), $.rs6 = dom(), br(),\\n\\"ç»è¿‡ä¸Šé¢çš„éªŒè¯ï¼Œå¯ä»¥å‘ç°ï¼šåˆ†åˆ«æµ‹é‡æ¯ä¸ªå­—ç¬¦çš„å®½åº¦å†ç›¸åŠ å¹¶ä¸ç­‰äºç›´æ¥æµ‹é‡çš„ç»“æœã€‚\\", br(),\\n\\"å¯¹äºè¿™ä¸ªçŠ¶å†µï¼Œæˆ‘æœ‰ä¸€äº›è§‚å¯Ÿï¼š\\",\\nul(li(\\"å¦‚æœä¸ºæ¯ä¸ªå­—ç¬¦ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„spanï¼Œå°†spançš„é•¿åº¦æŒ‡å®šä¸ºå•ä¸ªå­—ç¬¦çš„é•¿åº¦ï¼Œå°±å¯ä»¥ä½¿ç”¨åˆ†å¼€æµ‹é‡å†ç›¸åŠ çš„ç­–ç•¥äº†ã€‚\\"),\\n   li(\\"ç»æµ‹è¯•ï¼Œcanvaså’Œdomæµ‹é‡å¾—åˆ°çš„ç»“æœå¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œç–‘ä¼¼æ˜¯fallbackçš„å­—ä½“ä¸ä¸€è‡´ï¼Œè¿™ä¸ªé—®é¢˜è¿˜éœ€è¦ç»§ç»­ç ”ç©¶ã€‚\\"),\\n   li(\\"å¦‚æœä½¿ç”¨å°†æ–‡æœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æµ‹é‡çš„ç­–ç•¥ï¼Œé‚£ä¹ˆè‡³å°‘è¿˜éœ€è¦æ€è€ƒå¦‚ä½•æœ€å°åŒ–å¯¹textwidthçš„è°ƒç”¨ã€‚\\", br(),\\n      \\"ï¼ˆå› ä¸ºè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹æ…¢çš„å‡½æ•°ï¼‰\\", br(),\\n      \\"è¿™æ–¹é¢å¯ä»¥è§‚å¯Ÿä¸€ä¸‹vscodeçš„è¡Œä¸ºï¼š\\",\\n      ul(li(\\"vscodeä¸­ä¸ç®¡æ–‡æœ¬å†…å®¹ä¸ºä½•ï¼Œå…‰æ ‡çš„ä½ç½®éƒ½æ˜¯æ­£ç¡®çš„ã€‚\\", br(),\\n            \\"ç‚¹å‡»æŸä¸ªä½ç½®ï¼Œå…‰æ ‡ç§»åŠ¨åˆ°çš„å­—ç¬¦ä½ç½®ä¹Ÿæ˜¯æ­£ç¡®çš„ã€‚\\", br(),\\n            \\"ï¼ˆå³ä½¿åœ¨æ•´ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨éƒ½è¢«transformæ ·å¼ç¼©æ”¾çš„æƒ…å†µä¸‹ï¼Œå…‰æ ‡çš„ä½ç½®ä¹Ÿæ˜¯æ€»æ˜¯æ­£ç¡®çš„ï¼‰\\"),\\n         li(\\"å¦‚æœä½¿ç”¨ä¸€äº›å¤šä¸ªå­—ç¬¦åˆæˆçš„emojiå¦‚ğŸ‘¨ğŸ¿â€ğŸ”§ï¼Œvscodeçš„è‡ªåŠ¨æ¢è¡Œä¼šå‘ç”Ÿå¾—éå¸¸æ—©ã€‚\\", br(),\\n            \\"æ­¤æ—¶å¦‚æœé€‰æ‹©ä¸€è¡Œæ–‡æœ¬ï¼Œå¯ä»¥åœ¨çŠ¶æ€æ çš„å³ä¸‹è§’çœ‹åˆ°ï¼Œé€‰æ‹©å‡ºçš„å­—ç¬¦æ•°é‡è¿œå¤§äºçœ‹èµ·æ¥çš„å­—ç¬¦æ•°é‡ã€‚\\"),\\n         li(\\"å’Œä¸Šä¸€æ¡ç›¸åŒçš„æƒ…å†µï¼Œåœ¨è¡Œä¹‹é—´åˆ‡æ¢å…‰æ ‡æ—¶ï¼Œå…‰æ ‡å¹¶ä¸æ˜¯æŒ‰è§†è§‰ä½ç½®åœ¨ç§»åŠ¨ï¼Œè€Œæ˜¯ç§»åŠ¨åˆ°å…·æœ‰ç›¸åŒå­—ç¬¦æ•°çš„ä½ç½®ã€‚\\", br(),\\n            \\"å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä½ç½®å’Œé€‰æ‹©æ—¶æŸ¥çœ‹åˆ°çš„å­—ç¬¦æ•°é‡åˆæœ‰æ‰€ä¸åŒã€‚\\", br(),\\n            \\"ï¼ˆåœ¨ä»15ä¸ªå’ŒğŸ‘¨ğŸ¿â€ğŸ”§ç±»ä¼¼å­—ç¬¦æ„æˆçš„è¡Œï¼Œç§»åŠ¨åˆ°å…¨éƒ¨ä¸ºè‹±æ–‡å­—æ¯çš„è¡Œä¸­æ—¶ï¼Œå¯¹åº”çš„ä½ç½®æ˜¯30ï¼Œé€‰æ‹©çš„å­—ç¬¦æ•°åˆ™ä¸º65ï¼‰\\"),\\n        ),\\n      \\"æ ¹æ®è¿™äº›ç°è±¡ï¼Œå¯ä»¥å¤§æ¦‚æƒ³è±¡vscodeçš„å®ç°ï¼š\\",\\n      ul(li(\\"å¯¹äºå…‰æ ‡ä½ç½®ï¼Œvscodeæ€»æ˜¯ä½¿ç”¨ç±»ä¼¼canvasæµ‹é‡çš„æ–¹æ³•ã€‚\\"),\\n         li(\\"å¯¹äºæ¢è¡Œä½ç½®ï¼Œå…¨éƒ¨ä½¿ç”¨canvasæµ‹é‡å°±å¤ªæ…¢äº†ï¼Œå› æ­¤ç”¨å­—ç¬¦æ•°é‡ä½œä¸ºæ¢è¡Œçš„ä¾æ®ã€‚\\"),\\n         li(\\"å¯¹äºåœ¨è¡Œé—´åˆ‡æ¢å…‰æ ‡ï¼Œåªèƒ½è¯´æ˜¯å’Œå­—ç¬¦æ•°é‡ç›¸å…³ï¼Œä½†å…·ä½“æ€ä¹ˆå®ç°çš„æš‚æ—¶ä¸æ¸…æ¥šã€‚\\"),\\n        ),\\n     ),\\n  ), br(),\\n\\"æ¥ç€å°è¯•ä¿®å¤canvasæµ‹é‡ä¸domæµ‹é‡ä¸å®Œå…¨ç›¸åŒçš„é—®é¢˜ï¼š\\",\\ncode(() => {}),\\nbr(), \\"ç„¶åå°†æµ‹é‡å‡½æ•°ä¸å®é™…çš„æ–‡æœ¬ç¼–è¾‘å™¨ç»“åˆèµ·æ¥ï¼š\\", code(() => {}),\\nbr(), \\"å…³äºå…‰æ ‡çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•è·å–é¼ æ ‡å¯¹åº”çš„æ–‡æœ¬ä½ç½®ã€‚\\", br(),\\n\\"ç”±äºæˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•è®¡ç®—å›ºå®šæ–‡æœ¬çš„é•¿åº¦äº†ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨äºŒåˆ†æœç´¢å¤šæ¬¡æŸ¥è¯¢å­—ç¬¦ä¸²é•¿åº¦ï¼Œä»è€Œå¾—åˆ°å…‰æ ‡çš„å®é™…ä½ç½®ï¼Œå®ç°å¦‚ä¸‹ï¼š\\",\\ncode(() => {}), dom({class:\\"spbar\\"}), \\"çœŸjréº»çƒ¦ï¼Œä¸å†™äº†ã€‚\\",br(),\\nbr(), \\"å³ä½¿æˆ‘æŠŠcanvasæµ‹é‡æ­£ç¡®å®ç°äº†ï¼Œåé¢çš„å·¥ä½œä¹Ÿä»ç„¶æŒºéº»çƒ¦çš„ï¼Œå…³é”®æ˜¯ï¼Œè¿™äº›å·¥ä½œç°é˜¶æ®µçš„æ”¶ç›Šä¸æ˜¯é‚£ä¹ˆå¤§ã€‚\\",br(),\\n\\"ä½†æ˜¯æ–‡æœ¬ç¼–è¾‘å™¨è¿˜æ˜¯è¦æœ‰çš„ï¼Œæ‹¿textareaæ”¹æ”¹æ ·å¼å¾—äº†ï¼Œä¸‹é¢æ”¹ä¸ºç ”ç©¶å¦‚ä½•æŠŠtextareaå°è£…ä¸ºä¸€ä¸ªè‡ªå®šä¹‰æ ‡ç­¾ã€‚\\", dom({class:\\"spbar\\"}),\\n\\"\\"\\n]})"},{"v":"style(document.documentElement, {width:\\"50%\\"}), style(document.body, {margin:8})\\nconst mktag = t => $[t] = (...a) => dom({tag:t, child:a}), lh = 20\\n\\"h2 p br pre b ul ol li span div\\".split(\\" \\").forEach(mktag)\\n$.ta = (v = \\"\\") => dom({ tag: \\"textarea\\", spellcheck: false, value: v })\\n$.code = (v = \\"\\", e = true) => (\\n  isfct(v) ? (e ? setTimeout(v) : 0, v = fct2str(v)): 0, dom({ class: \\"code\\", innerText: v }))\\ncss(\\".spbar\\", {width:\\"calc(100% - 2em)\\", margin:\\"1em\\", height:1, backgroundColor:\\"black\\"})\\n\\nconst codefont = { lineHeight: lh, fontSize: \\"1em\\", fontFamily: \\"consolas\\", whiteSpace: \\"pre-wrap\\" }\\ncss(\\".code, .test\\", codefont, { background:\\"#1d191d\\", color:\\"#cbd3d2\\"},\\n  { margin: \\"0.2em 0\\", padding: \\"0.2em 0\\", paddingLeft: \\"2em\\" })\\ncss(\\".accident\\", {color:\\"red\\"})\\nstyle(document.body, { margin: \\"1em\\" }); css(\\"ul, ol\\", { margin: 0 })\\n\\nelm(document.body, {child:[h2(\\"å‡çº§æ–‡å­¦ç¼–ç¨‹ç¼–è¾‘å™¨\\")]})"},{"v":"style(document.documentElement, {width:\\"50%\\"}), style(document.body, {margin:\\"1em\\"})\\nconst mktag = t => $[t] = (...a) => dom({tag:t, child:a})\\n\\"h2 p br pre b\\".split(\\" \\").forEach(mktag)\\nconst testtext = ``\\nelm(document.body, {child:[\\nh2(\\"æ­£åˆ™è¡¨è¾¾å¼\\"), \\"ä¸€ä¸ªç®€æ˜“çš„æ­£åˆ™æµ‹è¯•ç¯å¢ƒ\\"]})"},{"v":"style(document.documentElement, {width:\\"50%\\"}), style(document.body, {margin:\\"1em\\"})\\nconst mktag = t => $[t] = (...a) => dom({tag:t, child:a})\\n\\"h2 p br pre b\\".split(\\" \\").forEach(mktag)\\nconst onclick = () => {\\n  const r = initspeech2text(), lang = \\"zh-CN\\" // ä¿®æ”¹è¿™ä¸ªå­—ç¬¦ä¸²ä¸ºzh-CNå¯ä»¥è¯†åˆ«ä¸­æ–‡\\n  assign(r, { lang, interimResults: true, maxAlternatives: 1 })\\n  const s = () => trycatch(() => ($.tmp = dom({}, document.body), r.start()))\\n  const onresult = e => tmp.innerText = e.results[0][0].transcript\\n  assign(r, { onend: s, onresult }), s() }\\nelm(document.body, {child:[\\nh2(\\"ä¸€ä¸ªç®€å•çš„è¯­éŸ³è¯†åˆ«çš„ä¾‹å­\\"), \\"ï¼ˆ**å¹¶éæ–‡ç« çš„ä¸»è¦å†…å®¹**ï¼‰\\",\\ndom({tag:\\"button\\", child:\\"ç‚¹æˆ‘å¼€å§‹è¯­éŸ³è¯†åˆ«\\", onclick }), br(),\\n\\"ä¸‹é¢çš„å†…å®¹æ˜¯ä½¿ç”¨jsçš„toStringåŠŸèƒ½æ‹¿åˆ°çš„å‡½æ•°æºç ï¼Œä¹Ÿå°±æ˜¯è¯´å®é™…æ‰§è¡Œçš„ä»£ç ä¸æˆ‘å±•ç¤ºçš„ä»£ç çš„æ€»æ˜¯ä¸€è‡´çš„ï¼š\\",\\npre(fct2str(onclick)), \\"ç”±äºä¸€äº›å®ç°ä¸Šçš„åŸå› ï¼ŒåŒæ—¶å­˜åœ¨ä¸¤ä¸ªSpeechRecognitionå¯¹è±¡çš„è¯ä¼šå¯¼è‡´é¡µé¢éå¸¸å¡é¡¿ï¼Œæ‰€ä»¥æˆ‘åœ¨ç¼–è¾‘å™¨é‡Œå…ˆå®ç°äº†ä¸€ä¸ªinitspeech2textå‡½æ•°ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå…¬ç”¨çš„SpeechRecognitionå¯¹è±¡ï¼Œå…¶ä½™éƒ¨åˆ†å°±å’Œä¸€èˆ¬çš„jså®Œå…¨ä¸€è‡´äº†ã€‚\\", br(), br(),\\n\\"è¯­éŸ³è¯†åˆ«å‡ºçš„å†…å®¹æ˜¾ç¤ºåœ¨è¿™é‡Œï¼š\\"]})"},{"v":"style(document.documentElement, {width:\\"50%\\"}), style(document.body, {margin:\\"1em\\"})\\ncss(\\"ul, ol\\", {margin:0, paddingLeft:\\"2em\\"})\\nconst mktag = t => $[t] = (...a) => dom({tag:t, child:a})\\n\\"h2 p br pre b\\".split(\\" \\").forEach(mktag)\\nconst updvoice = () => $.voices = s.getVoices()\\nconst s = assign(speechSynthesis, { onvoiceschanged: updvoice })\\nconst speak = t => (s.cancel(), s.speak(assign(\\n  new SpeechSynthesisUtterance(t), { onerror: log, voice: voices[vi] })))\\nupdvoice(); const vs={}; voices.forEach((v, i) => (vs[v.lang]??=[]).push((v.i = i, v)))\\nelm(document.body, {child:[ h2(\\"ä¸€ä¸ªç®€å•çš„æ–‡æœ¬æœ—è¯»çš„ä¾‹å­\\"),\\n  \\"ï¼ˆ**å¹¶éæ–‡ç« çš„ä¸»è¦å†…å®¹**ï¼‰ä½¿ç”¨speakå‡½æ•°æœ—è¯»æ–‡æœ¬ï¼Œå¯ç”¨çš„è¯­éŸ³åˆ—è¡¨ï¼š\\", br(), $.ll=dom()]})\\nconst item = v => dom({ tag: \\"li\\", child: `${v.i}: ${v.name}` }); forin(vs, (v, k) =>\\n  elm(ll, { child: [br(), k + \\": \\", dom({ tag: \\"ul\\", child: v.map(item) })] }))\\n\\nconst vi = 19 // ç”¨è¿™ä¸ªåºå·é€‰æ‹©è¯­éŸ³\\nspeak(``) // æƒ³è¯´çš„è¯å†™åœ¨è¿™é‡Œ"}]}'
store.def(preload)

const fct2str = (f, s = String(f)) => {
  const t = s.slice(s.indexOf("{") + 1, s.lastIndexOf("}"))
  const a = t.split(/\r?\n/); if (a[0] === "" && a.length > 1) a.shift()
  const n = a[0].match(/^[\s]+/)?.[0].length ?? 0
  return a.map(v => v.slice(n)).join("\r\n").trim()
}

const lh = 18, setth = t => style(t, { height: t.value.split(/\r?\n/).length * lh })
const editor = d => {
  let sdbx, r = dom({ style: { display: "flex" } }), onkeydown = e =>
    e.key.toLowerCase() === "s" && (e.ctrlKey || e.altKey) ? (e.preventDefault(), upd())
      : e.key.toLowerCase() === "n" && e.altKey ? splice(d.i + 1, 0, { v: "" })
        : e.key.toLowerCase() === "w" && e.altKey ? splice(d.i, 1) : 0
  const upd = () => trycatch(() => (d.v = t.value, save(), refresh(),
    style(t, { color: "" })), e => (style(t, { color: "red" }), panic(e)))
  const t = dom({ tag: "textarea", value: d.v, onkeydown })
  elm(t, { oninput: () => setth(t), spellcheck: false })
  style(t, { resize: "none", width: "calc(50% - 6px)", lineHeight: lh })
  style(t, { whiteSpace: "pre", overflow: "hidden", fontFamily: "consolas, courier" })
  const extra = { fct2str, preload }
  const refresh = () => (sdbx?.destroy(), sdbx = sandbox(assign(scope($), { extra })),
    r = elm(r, { child: [t, sdbx.document.documentElement], diff: true }),
    Function("$", `with($){\n${d.v}\n}`)(sdbx))
  setth(t), setTimeout(refresh), d.d = r; return d
}

$.save = () => store.set(gsl, data.map(({ v }) => ({ v })))
$.sync = () => elm(editors, { child: data.map(({ d }) => d), diff: true })
$.splice = (s, c, ...a) => (data.splice(s, c, ...a.map(editor)),
  data.length > 0 ? 0 : data.push(editor({ v: "" })),
  forrg(data.length, i => data[i].i = i), sync())
const gsl = "global-state-location"; store.get(gsl).then(v => (
  body.append($.editors = dom()), $.data = [], splice(0, 0, ...v ?? [])))